## 一、格式化字符串语法

> `str.fromat()`方法和`Formatter()`类使用同一个格式化字符串语法（如果是`Formatter`类，子类可以定义自己的格式化语法。）。该语法与[格式化的字符串文字](https://docs.python.org/3/reference/lexical_analysis.html#f-strings)相关，但是略微有所区别。

格式化字符串使用花括号({})包裹替换字段。任何包裹在括号里的文本，都会原封不动地输出。如果需要在文本信息中包含花括号，可以通过加倍{{和}}来对其进行转义。

1、替换字段语法如下：

```
replacement_field ::=  "{" [field_name] ["!" conversion] [":" format_spec] "}"
field_name        ::=  arg_name ("." attribute_name | "[" element_index "]")*
arg_name          ::=  [identifier | digit+]
attribute_name    ::=  identifier
element_index     ::=  digit+ | index_string
index_string      ::=  <any source character except "]"> +
conversion        ::=  "r" | "s" | "a"
format_spec       ::=  <described in the next section>
```

2、使用概述：

在非正式的术语中，替换字段`field_name`开头，该字段指定需要将其值格式化并插入输出而不是替换字段。`field_name`后跟前面带感叹号(!)的转换字段(conversation)和前面带冒号(:)的`format_spec`字段。这些为指定替换值的非默认格式。

3、使用说明如下：

* 01、`field_name`本身以`arg_name`开头，`arg_name`是数字或关键字。如果它是一个数字，它引用一个位置参数，如果它是一个关键字，它引用一个命名关键字参数。如果格式字符串中的数字`arg_names`按顺序为0,1,2，...，它们都可以省略（不仅仅是一些），数字0,1,2，...将按顺序自动插入。因为`arg_name`不是引号分隔的，所以不能在格式字符串中指定任意字典键（例如，字符串'10'或'： - ]'）。 `arg_name`后面可以跟任意数量的索引或属性表达式。“.name”形式的表达式使用getattr（）选择命名属性，而“[index]”形式的表达式使用`__getitem __（）`执行索引查找。【来自谷歌翻译】

一些简单的例子如下：

```
"First, thou shalt count to {0}"  # References first positional argument
"Bring me a {}"                   # Implicitly references the first positional argument
"From {} to {}"                   # Same as "From {0} to {1}"
"My quest is {name}"              # References keyword argument 'name'
"Weight in tons {0.weight}"       # 'weight' attribute of first positional arg
"Units destroyed: {players[0]}"   # First element of keyword argument 'players'.
```

* 02、`conversation`字段在格式化之前导致类型强制。一般，格式化值的工作是由值本身的`__format()__`方法做的。但是，在某些情况下，最好强制将类型格式化为字符串，从而覆盖自己的格式化定义。通过在调用`__format__()`方法之前转换字符串的值，普通的格式化逻辑可以被绕过。

现在支持的三种转换标志：`!s`调用`str()`方法，`!r`调用`repr()`方法，`!a`调用`ascii()`方法。

一些例子如下：

```
"Harold's a clever {0!s}"        # Calls str() on the argument first
"Bring out the holy {name!r}"    # Calls repr() on the argument first
"More {!a}"                      # Calls ascii() on the argument first
```

* 03、`format_spec`字段指定值如何显示，包括宽度(width)、对齐方式(alignment)、间距(padding)以及数字精确度(precision)等等。每种值都可以定义自己的"格式化微语言"或`format_spec`的解释

更多支持常规微语言的内置类型，将在第二部分进行描述。

## 二、格式规范化微语言

> "格式规范"用于格式字符串中包含的替换字段中，以定义各个值的显示方式（请参阅格式字符串语法和格式化字符串文字）。它们也可以直接传递给内置的`format()`函数。

1、标准格式说明符的一般形式如下：

```
format_spec     ::=  [[fill]align][sign][#][0][width][grouping_option][.precision][type]
fill            ::=  <any character>
align           ::=  "<" | ">" | "=" | "^"
sign            ::=  "+" | "-" | " "
width           ::=  digit+
grouping_option ::=  "_" | ","
precision       ::=  digit+
type            ::=  "b" | "c" | "d" | "e" | "E" | "f" | "F" | "g" | "G" | "n" | "o" | "s" | "x" | "X" | "%"
```

使用说明如下：

* 01、fill 表示填充字符串，可以为任意值；
```
print('{0:0<5d}'.format(15))  # 结果为'15000'
```
* align 表示对齐方式，支持如下四种值
    * < 左对齐
    * \> 右对齐
    * ^ 居中
    * = 强制将填充放置在符号(如果有)之后但再数字之前。

```
# 采用不填充效果的测试代码
'{:<10d}'.format(2)  # 结果为: '2         '
'{:>10d}'.format(2)  # 结果为: '         2'
'{:^10d}'.format(2)  # 结果为: '    2     '
'{:=10d}'.format(+2)  # 结果为: '        2'
'{:=10d}'.format(-2)  # 结果为: '-       2'

# 采用填充效果更好的测试代码
print('{:0<10d}'.format(2))  # 结果为: '2000000000'
print('{:0>10d}'.format(2))  # 结果为: '0000000002'
print('{:0^10d}'.format(2))  # 结果为: '0000200000'
print('{:0=10d}'.format(+2))  # 结果为: '0000000002'
print('{:0=10d}'.format(-2))  # 结果为: '-000000002'
```
* 02、sign 表示符号，+标志可用于正数和负数之前，-标志只能用于负数之前，空字符串标志应用在正数之前表示前导空格，应用在负数之前表示为-号，支持的sign值为+、-、" "三种。

例子如下：

```
'{:0>+10d}'.format(2)  # 结果为: '00000000+2'
'{:0>+10d}'.format(-2)  # 结果为: '00000000-2'

'{:0>-10d}'.format(2)  # 结果为: '00000000-2'

'{:0> 10d}'.format(2)  # 结果为: '00000000 2'
'{:0> 10d}'.format(-2)  # 结果为: '00000000-2'
```
* 03、\# 主要使"替代形式"用于转换。对于不同类型，替代形式的定义不同。此选项仅对interger、float、complex和Decimal类型有效。对于正数，当使用二进制、八进制或十六进制输出时，此选项将被替换为前缀"oB"、"0O"、"oX"进行输出。对于浮点数、负数和十进制，备用形式会导致转换结果始终包含小数点字符，即使小数点后没有数字也是如此。通常，只有在跟随数字的情况下，这些转换的结果才会出现小数点字符。此外，对于"g"和"G"转换，不会从尾随结果中删除尾随零。

例子如下：[根据python版本3.5.4的验证结果，不支持大写B和大写O，支持大写X]

```
print('{:#b}'.format(128))  # 结果为: 0b10000000
print('{:#o}'.format(128))  # 结果为: 0o200
print('{:#x}'.format(128))  # 结果为: 0x80
print('{:#X}'.format(128))  # 结果为: 0X80
```

* 04、`grouping_option`(可以理解为分组选项)，支持_和,两种值。
    * ',' 主要用于千位分割符。对于区域设置感知分割符，请改用"n"整数表示类型[需要python版本3.1以上才能使用]
    * '_' 表示对数字分隔符使用下划线表示浮点表示类型和整数表示类型'd'。对于整数表示类型'b'、'o'、'x'和'X'，下划线将每四位数插入一次。对于其他演示文稿类型，指定此选项是错误的。[需要python版本3.6以上才能使用]

例子如下:

```
print('{:,}'.format(1230000000000))  # 结果为: 1,230,000,000,000
print('{:_}'.format(1230000000000))  # 结果为: 1_230_000_000_000
print('{:_}'.format(1230000000000.128000))  # 结果为: 1_230_000_000_000.128
print('{:#_b}'.format(1222222222))   # 结果为: 0b100_1000_1101_1001_1010_0001_1000_1110
print('{:#_o}'.format(1222222222))   # 结果为: 0o110_6632_0616
print('{:#_x}'.format(1222222222))   # 结果为: 0x48d9_a18e
print('{:#_X}'.format(1222222222))   # 结果为: 0X48D9_A18E

print('{:_}'.format(0b100_1000_1101_1001_1010_0001_1000_1110))  # 结果为: 1_222_222_222
print('{:_}'.format(0b1001000110110011010000110001110))  # 结果为: 1_222_222_222
# 同理八进制和16进制，不再提供相关例子
```

* 05、`width`(宽度)是一个定义字段最小宽度的十进制数。如果未指定，字段宽度会由内容来决定。如果没有给定明确的对齐，则在宽度字段前面加零('0')字符可以为数字类型启用符号识别的零填充。这相当于填充字符'0'，对齐类型为'='。

例子如下：
```
print('{:0<10d}'.format(2))  # 结果为: '2000000000'
print('{:0>10d}'.format(2))  # 结果为: '0000000002'
print('{:0^10d}'.format(2))  # 结果为: '0000200000'
print('{:0=10d}'.format(+2))  # 结果为: '0000000002'
print('{:0=10d}'.format(-2))  # 结果为: '-000000002'
```

* 06、`.precision` 精度是一个十进制数，表示在用'f'和'F'格式化的浮点值的小数点后面应显示多少位数，或者用'g'或'G'表示格式化浮点值的小数点前后的总位数。对于非数字类型，该字段表示最大字段大小 - 换句话说，将使用字段内容中将使用的字符数。 整数值不允许精度。

例子如下：
```
print('{:.2f}'.format(123.672323))  # 结果为: 123.67
print('{:.2F}'.format(123.672323))  # 结果为: 123.67
print('{:.4g}'.format(123.672323))  # 结果为: 123.7
print('{:.4G}'.format(123.672323))  # 结果为: 123.7
```

* 06、`type` 类型决定数据如何显示。

    * A、可用的字符串显示类型

    | 类型 | 说明 |
    | - | - |
    | 's' | 字符串格式。字符串默认的格式而且可以省略|
    | None | 与's'相同|

    * B、可用的整数显示类型

    | 类型 | 说明 |
    | - | - |
    | 'b' | 二进制格式。以二进制输出数字。|
    | 'c' | 字符。在打印输出之前转换整数为相应的unicode字符。|
    | 'd' | 十进制整数。以十进制输出数字。|
    | 'o' | 八进制格式。以八进制输出数字。|
    | 'x' | 十六进制格式。以十六进制输出数字，大于9的数字使用小写字母。|
    | 'X' | 十六进制格式。以十六进制输出数字，大于9的数字使用大写字母。|
    | 'n' | 数字。与'd'相同，只是它使用当前的语言环境设置来插入适当的数字分隔符。|
    | None | 与'd'相同|

    C、可用的浮点数和十进制数显示类型，除了B中呈现的类型，整数可以使用下述表格中的浮点数显示类型（除了'n'和None）

    | 类型 | 说明 |
    | - | - |
    | 'e' | 指数表示法。使用小写字母'e'显示指数来打印数字。默认精度为6。|
    | 'E' | 指数表示法。与'e'相同，除了使用大写字母'E'作为分隔符。|
    | 'f' | 定点表示法。以定点数显示数字。默认精度为6。|
    | 'F' | 定点表示法。与'f'相同，除了转换`nan`为`NAN`和`inf`为`INF`。|
    | 'g' | 一般格式。对于给定的精度 `p >= 1`，将四舍五入数字到`p`有效位并且根据量级对数字以定点格式或科学计数法格式化。<br><br>精确的规则如下：假设用表示类型'e'和精度p-1格式化的结果将具有指数exp。 然后，如果-4 <= exp <p，则使用表示类型“f”和精度p-1-exp格式化数字。否则，使用表示类型“e”和精度p-1格式化数字。 在这两种情况下，从有效数字中删除无关紧要的尾随零，如果后面没有剩余数字，则也会删除小数点。<br><br>无论精度如何，正负无穷大，正零和负零以及nans分别被格式化为inf，-inf，0，-0和nan。<br><br>精度0被视为等于1的精度。默认精度为6。 |
    | 'G' | 一般格式。与`'g'`相同，除了当数字量级很大会切换为`'E'`。无穷大和NAN也会以大写显示。|
    | 'n' | 数字。与`'g'`相同，但是如果数字很大会转为'E'(指数表示法)。 |
    | '%' | 百分数。数字乘以100并显示为固定(`'f'`)格式,后面跟一个百分号。|
    | None | 与`'g'`相同，除了当使用定点表示法，至少小数点后有一位数字。默认精度与表示特定值一样高。 整体效果是匹配由其他格式修饰符更改的`str()`的输出。|

            更多例子：参见同目录下

            整理自：[官方文档](https://docs.python.org/3/library/string.html#format-string-syntax)

            整理作者：FengHui

            整理时间：201902021010